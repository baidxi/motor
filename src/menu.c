#include <menu/menu.h>

#include <stdio.h>

struct device;

#include <zephyr/logging/log.h>

LOG_MODULE_DECLARE(menu, CONFIG_LOG_DEFAULT_LEVEL);

// Placeholder for an 8x8 'off' image (a red square)
// static const uint16_t img_off_data[300] = {
//     0x0000, 0x0000, 0xA2EC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 
//     0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 
//     0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA1DC, 0xA2D4, 0x0000, 
//     0x0000, 0x0000, 0xA1D4, 0xA2DC, 0x82DC, 0xA2DC, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x40AD, 0xC1DC, 0xA2DC, 0xA2DC, 
//     0x82DC, 0x0000, 0xC2DC, 0xA2DC, 0x82D4, 0x0000, 0xA2D4, 0xA2DC, 
//     0xA2DC, 0xA2DC, 0xA2DC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0xA2DC, 0xA2DC, 0x82CC, 0xA2DC, 0xA2DC, 0x0000, 0x82DC, 0xA2DC, 
//     0xC2E4, 0xC2E4, 0xE2E4, 0xA2DC, 0xA2DC, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0xA2DC, 0xA2DC, 0xA2DC, 0x61D4, 0x81DC, 0xA2DC, 
//     0xC2E4, 0xA2DC, 0xA2DC, 0xA2DC, 0xC2E4, 0xA2DC, 0xE2D4, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x82DC, 0xA2DC, 0xA2DC, 0x0000, 0xA2DC, 
//     0xC2E4, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0x81D4, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0xE07B, 0xA2DC, 0xA2DC, 0x0000, 
//     0x82DC, 0xC2E4, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xC2E4, 
//     0xA2DC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xE07B, 0xA2DC, 0xA2DC, 
//     0x81DC, 0xC2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xC2E4, 
//     0xA2DC, 0x82DC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xC2DC, 0xA2DC, 
//     0xA2DC, 0xA2DC, 0x0000, 0xA2DC, 0xC2E4, 0xC2E4, 0xC2E4, 0xC2E4, 
//     0xA2DC, 0xA2DC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xA2DC, 
//     0xA2DC, 0xC2DC, 0xA2DC, 0xA2DC, 0x0000, 0xA1DC, 0xA2DC, 0xA2DC, 
//     0xA2DC, 0xA2DC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0xA2DC, 
//     0xA2DC, 0x42CC, 0x0000, 0x82DC, 0xA2DC, 0xA2DC, 0x82DC, 0xE0FB, 
//     0xC0CC, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x40FD, 0x81DC, 0xA2DC, 
//     0x82DC, 0x82D4, 0x0000, 0x0000, 0x0000, 0xC3E4, 0xA2DC, 0xA2DC, 
//     0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 
//     0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 0xA2DC, 
//     0xA1DC, 0x42D4, 0x0000, 0x0000
// };

// // Placeholder for an 8x8 'on' image (a green square)
// static const uint16_t img_on_data[300] = {
//     0x0000, 0x0000, 0x5F11, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 
//     0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 
//     0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3E09, 0x3D09, 0x5D11, 0x0000, 
//     0x0000, 0x0000, 0x3D09, 0x3E09, 0x3D11, 0x3E09, 0x1F00, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x3E11, 0x3D11, 0x3D09, 
//     0x1D11, 0x0000, 0x1D11, 0x3E09, 0x1D11, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x3D11, 0x3E09, 0x3E09, 0x3E09, 0x3E09, 0x0000, 
//     0x3E11, 0x3E09, 0x3D11, 0x3E09, 0x3E09, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x3E09, 0x3E09, 0x3F11, 0x3E09, 0x3F09, 0x3F11, 
//     0x3E09, 0x0000, 0x3E09, 0x3E09, 0x3D09, 0x1D11, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x5E09, 0x3E09, 0x3E09, 0x3E09, 0x3E09, 0x3E09, 
//     0x3E09, 0x3E09, 0x3E09, 0x1E09, 0x3D09, 0x3E09, 0x0F00, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x1E09, 0x3E09, 0x3E09, 0x3E09, 0x3E09, 
//     0x3E09, 0x3E09, 0x3F11, 0x3D09, 0x0000, 0x3E09, 0x3E09, 0x0F00, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x1E09, 0x3E09, 0x3E09, 0x3E09, 
//     0x3E09, 0x3E09, 0x3E09, 0x3F11, 0x3D09, 0x0000, 0x3E09, 0x3D09, 
//     0x1D11, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x9F19, 0x3D09, 0x3F09, 
//     0x3E09, 0x3E09, 0x3E09, 0x3E09, 0x3E09, 0x1E09, 0x5E09, 0x3D09, 
//     0x3E09, 0x1E09, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1E09, 
//     0x3E09, 0x3F09, 0x3F11, 0x3F11, 0x3E09, 0x1D11, 0x0000, 0x3E09, 
//     0x1D09, 0x1D11, 0x3E09, 0x1D11, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0xFD10, 0x3E09, 0x3E09, 0x3E09, 0x3D09, 0x0000, 0x1D09, 
//     0x3E09, 0x1D11, 0x0000, 0x1D11, 0x3D09, 0x3E11, 0x1E09, 0xBF02, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 
//     0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x0000, 0x1E11, 0x3E11, 
//     0x3D09, 0x1D11, 0x0000, 0x0000, 0x0000, 0x9F19, 0x3E09, 0x3E09, 
//     0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 
//     0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3D09, 0x3E09, 
//     0x3E09, 0x7F11, 0x0000, 0x0000
// };

extern void motor_ctrl(void *ctrl, bool enable);
extern void menu_driver_start(struct menu_t *menu, void (*start)(void *, bool), bool en);

static void startup_checkbox_cb(struct menu_item_t *item, bool is_on)
{
    LOG_INF("Startup checkbox is now %s", is_on ? "ON" : "OFF");
    // menu_driver_start(item->menu, &motor_ctrl, is_on);
    menu_disable_qdec(item->menu, is_on);
}

static struct menu_item_t setup_item = {
    .name = "Setup",
    .id = 1,
    .style = MENU_STYLE_HIGHLIGHT | MENU_STYLE_BORDER,
    .visible = true,
};

static struct menu_item_t startup_item = {
    .name = "Run",
    .id = 2,
    .style = MENU_STYLE_NORMAL | MENU_STYLE_VALUE_ONLY | MENU_SET_COLOR(COLOR_GREEN),
    .type = MENU_ITEM_TYPE_CHECKBOX,
    .checkbox = {
        .is_on = false,
        .cb = startup_checkbox_cb,
        .text_on = "Stop",
        .text_off = "Start",
    },
};

static struct menu_item_t setup_display_item = {
    .name = "Display",
    .id = 4,
    .style = MENU_STYLE_NORMAL,
};

static struct menu_item_t setup_power_item = {
    .name = "Power",
    .id = 5,
    .style = MENU_STYLE_NORMAL,
};



// static void test_checkbox_cb(struct menu_item_t *item, bool is_on)
// {
//     LOG_INF("Test checkbox is now %s", is_on ? "ON" : "OFF");
// }

// static struct menu_item_t test_image_checkbox_item = {
//     .name = "Img",
//     .id = 10, // a new unique ID
//     .style = MENU_STYLE_CHECKBOX_IMG | MENU_STYLE_CENTER,
//     .type = MENU_ITEM_TYPE_CHECKBOX,
//     .checkbox = {
//         .is_on = false,
//         .cb = test_checkbox_cb,
//         .text_on = (const char *)img_on_data,
//         .text_off = (const char *)img_off_data,
//         .img_width = 25,
//         .img_height = 12,
//     },
// };

int menu_init(const struct device *dev, struct menu_t **out)
{
    struct menu_t *menu;
    struct menu_group_t *status_group;
    struct menu_group_t *main_group;
    struct menu_group_t *setup_group;
    extern struct menu_item_t setup_motor_item;
    // extern struct menu_item_t status_vbus_item;

    menu = menu_create(dev);

    if (!menu)
    {
        return -1;
    }

    status_group = menu_group_create(menu, "Status", 60, 5, 100, 75, COLOR_BLUE, MENU_LAYOUT_VERTICAL | MENU_ALIGN_V_CENTER, MENU_STYLE_LEFT);
    
    // menu_group_add_item(status_group, &status_vbus_item);

    main_group = menu_group_create(menu, "main", 0, 5, 55, 75, COLOR_WHITE, MENU_LAYOUT_VERTICAL | MENU_ALIGN_V_CENTER, MENU_STYLE_CENTER);

    menu_group_add_item(main_group, &setup_item);
    menu_group_add_item(main_group, &startup_item);
    // menu_group_add_item(main_group, &test_image_checkbox_item);

    setup_group = menu_group_create(menu, "Setup", 40, 5, 100, 75, COLOR_MAGENTA, MENU_LAYOUT_VERTICAL | MENU_ALIGN_V_CENTER, MENU_STYLE_CENTER);

    menu_group_add_item(setup_group, &setup_motor_item);
    menu_group_add_item(setup_group, &setup_display_item);
    menu_group_add_item(setup_group, &setup_power_item);
    menu_group_bind_item(setup_group, &setup_item);

    menu_set_main_group(menu, main_group);

    if (out)
        *out = menu;

    return 0;
}